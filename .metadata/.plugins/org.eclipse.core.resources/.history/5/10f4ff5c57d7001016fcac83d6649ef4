package LeetCodeDaily;

import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class Solution_3433 {
    public int[] countMentions(int numberOfUsers, List<List<String>> events) {
        int[] ans=new int[numberOfUsers];
        events.sort((e1,e2)->{
        	int e1v= Integer.valueOf(e1.get(1));
        	int e2v=Integer.valueOf(e2.get(1));
        	if(e1v != e2v) {
        		return Integer.compare(e1v, e2v);
        	}else {
        		return e2.get(0).compareTo(e1.get(0));
        	}
        	
        });
        int len=events.size();
        int longTime=Integer.valueOf(events.get(len-1).get(1));
        Map<Integer,Integer> status =new HashMap<>();
        for(int i=0;i<len;i++) {
        	List<String> cur=events.get(i);
        	String msg=cur.get(0);
        	Integer time=Integer.valueOf(cur.get(1));
        	String users=cur.get(2);
        	if(msg.equals("MESSAGE")) {
        		if(users.equals("ALL")) {
        			for(int j=0;j<numberOfUsers;j++) ans[j]++;
        		}
        		else if(users.equals("HERE")) {
        			for(int j=0;j<numberOfUsers;j++) {
        				if(!status.containsKey(j)) ans[j]++;
        				else {
        					int curTime=Integer.valueOf(time);
        					if(status.get(j)<=curTime) {
        						ans[j]++;
        						status.remove(j);
        					}
        				}
        			}
        		}else {
        			String[] userArr = users.split(" ");
        			for(String user :userArr) {
        				Integer userId = Integer.valueOf(user.substring(2));
        				ans[userId]++;
        			}
        		}
        	}else if(msg.equals("OFFLINE")){
        		Integer nextTime=Integer.valueOf(time)+60;
        		Integer userId = Integer.valueOf(users);
        		status.put(userId, nextTime);
        	}
        }
        
        return ans;
    }

}
